<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Control de Stock - Solo Inglés</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    .stock-low {
      background-color: #fef2f2;
      border-left: 4px solid #ef4444;
    }
    .stock-medium {
      background-color: #fffbeb;
      border-left: 4px solid #f59e0b;
    }
    .stock-high {
      background-color: #f0fdf4;
      border-left: 4px solid #22c55e;
    }
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <header
    class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg"
  >
    <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center mb-4 md:mb-0">
          <i class="fas fa-utensils text-3xl mr-3"></i>
          <h1 class="text-2xl font-bold">ControlStock - Solo Inglés</h1>
        </div>
        <div class="flex items-center space-x-4">
          <span
            class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm"
          >
            <i class="fas fa-language mr-1"></i>Entrada multilenguaje, solo inglés
          </span>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow p-6 text-center">
        <div class="text-3xl font-bold text-blue-600" id="total-products">0</div>
        <div class="text-gray-600">Productos Totales</div>
      </div>
      <div class="bg-white rounded-lg shadow p-6 text-center">
        <div class="text-3xl font-bold text-green-600" id="in-stock">0</div>
        <div class="text-gray-600">En Stock</div>
      </div>
      <div class="bg-white rounded-lg shadow p-6 text-center">
        <div class="text-3xl font-bold text-red-600" id="low-stock">0</div>
        <div class="text-gray-600">Stock Bajo</div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">
        <i class="fas fa-magic mr-2 text-purple-500"></i>Agregar Producto (nombre en cualquier idioma, se traduce a inglés)
      </h2>
      <form id="add-product-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <div>
          <label for="product-name" class="block text-sm font-medium text-gray-700 mb-1"
            >Nombre del Producto</label
          >
          <input
            type="text"
            id="product-name"
            required
            placeholder="Ej: Tomate, Pomodoro, Tomato..."
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div>
          <label for="language-origin" class="block text-sm font-medium text-gray-700 mb-1"
            >Idioma de Origen</label
          >
          <select
            id="language-origin"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="es">Español</option>
            <option value="it">Italiano</option>
            <option value="en" selected>Inglés</option>
          </select>
        </div>
        <div>
          <label for="stock-qty" class="block text-sm font-medium text-gray-700 mb-1"
            >Cantidad en Stock</label
          >
          <input
            type="number"
            id="stock-qty"
            min="0"
            required
            placeholder="0"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div class="md:col-span-3">
          <button
            type="submit"
            id="submit-btn"
            class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-md font-medium transition duration-200"
          >
            <i class="fas fa-plus mr-2"></i>Agregar Producto
          </button>
        </div>
      </form>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">
        <i class="fas fa-list-alt mr-2 text-blue-500"></i>Inventario de Productos (Solo Inglés)
      </h2>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="bg-gray-100">
              <th class="px-4 py-2 text-left font-semibold text-gray-700">Inglés</th>
              <th class="px-4 py-2 text-center font-semibold text-gray-700">Cantidad</th>
              <th class="px-4 py-2 text-center font-semibold text-gray-700">Acciones</th>
            </tr>
          </thead>
          <tbody id="product-table-body">
            <!-- Productos se agregan aquí -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    let productos = [];

    const form = document.getElementById("add-product-form");
    const tbody = document.getElementById("product-table-body");
    const totalProductsEl = document.getElementById("total-products");
    const inStockEl = document.getElementById("in-stock");
    const lowStockEl = document.getElementById("low-stock");
    const submitBtn = document.getElementById("submit-btn");

    async function traducir(texto, sourceLang, targetLang = "en") {
      if (sourceLang === targetLang) return texto;
      try {
        const response = await fetch("https://libretranslate.de/translate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify({
            q: texto,
            source: sourceLang,
            target: targetLang,
            format: "text",
          }),
        });
        if (!response.ok) throw new Error("Error en la traducción");
        const data = await response.json();
        return data.translatedText || texto;
      } catch (error) {
        console.error("Error al traducir:", error);
        return texto; // fallback
      }
    }

    function actualizarInventario() {
      tbody.innerHTML = "";

      let total = productos.length;
      let enStock = 0;
      let stockBajo = 0;

      productos.forEach((prod, index) => {
        if (prod.cantidad > 0) enStock++;
        if (prod.cantidad > 0 && prod.cantidad <= 5) stockBajo++;

        const tr = document.createElement("tr");
        tr.classList.add("border-b");

        if (prod.cantidad <= 5) {
          tr.classList.add("stock-low");
        } else if (prod.cantidad <= 15) {
          tr.classList.add("stock-medium");
        } else {
          tr.classList.add("stock-high");
        }

        tr.innerHTML = `
          <td class="px-4 py-2 font-medium">${prod.nombre_en || "-"}</td>
          <td class="px-4 py-2 text-center font-bold ${
            prod.cantidad <= 5
              ? "text-red-600"
              : prod.cantidad <= 15
              ? "text-orange-500"
              : "text-green-600"
          }">${prod.cantidad}</td>
          <td class="px-4 py-2 text-center">
            <button class="text-red-600 hover:text-red-800 p-2 rounded hover:bg-red-50 transition" data-index="${index}" title="Eliminar">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;

        tbody.appendChild(tr);
      });

      totalProductsEl.textContent = total;
      inStockEl.textContent = enStock;
      lowStockEl.textContent = stockBajo;

      tbody.querySelectorAll("button").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const idx = e.currentTarget.getAttribute("data-index");
          if (confirm("¿Seguro que quieres eliminar este producto?")) {
            productos.splice(idx, 1);
            actualizarInventario();
          }
        });
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nombre = document.getElementById("product-name").value.trim();
      const idiomaOrigen = document.getElementById("language-origin").value;
      const cantidadStr = document.getElementById("stock-qty").value.trim();
      const cantidad = parseInt(cantidadStr, 10);

      if (!nombre) {
        alert("Por favor ingresa el nombre del producto.");
        return;
      }
      if (isNaN(cantidad) || cantidad < 0) {
        alert("Por favor ingresa una cantidad válida (0 o más).");
        return;
      }

      submitBtn.innerHTML =
        '<i class="fas fa-spinner fa-spin mr-2"></i>Traduciendo...';
      submitBtn.disabled = true;
      form.classList.add("loading");

      try {
        const nombreEn = await traducir(nombre, idiomaOrigen, "en");
        productos.push({ nombre_en: nombreEn, cantidad });
        actualizarInventario();
        form.reset();
      } catch (error) {
        alert("Error al traducir el nombre. Intenta de nuevo.");
      } finally {
        submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Agregar Producto';
        submitBtn.disabled = false;
        form.classList.remove("loading");
      }
    });

    actualizarInventario();
  </script>
</body>
</html>